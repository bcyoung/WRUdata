---
title: "WRU_squadscraping"
author: "BY"
date: "`r Sys.Date()`"
output: html_document
---
Install and load the libraries we need. Rvest is for scraping, and we use with the Polite package to, via robots.txt cache, checks the URL and user agent string against it and to the web page and enforces rate limiting.

```{r}
#install.packages("rvest")
#install.packages("dplyr")
install.packages("polite")

library(rvest)
library(polite)
library(dplyr)
library(tidyr)

```
Helpful pages on these packages: https://personales.upv.es/algarsal/R-tutorials/07_Tutorial-7_R-dplyr-tidyr.html
https://dmi3kno.github.io/polite/

Define the url and extract the html
```{r}
url <- "https://en.wikipedia.org/wiki/2008_Six_Nations_Championship_squads"

webpage <- read_html(url)
```

First, I need to inspect the web page structure to locate the table for the Wales squad. Wikipedia tables often have class names or other identifiers. Weâ€™ll look for a table under the Wales section.

Extract all tables from the webpage

```{r}
tables <- html_nodes(webpage, "table")
```

Wales table
```{r}
WRUSquad_2008 <- html_table(tables[[6]], fill = TRUE)
```
Convert the list to a data frame

```{r}
df_WRUSquad_2008 <- as.data.frame(WRUSquad_2008)
```

Clean up the column names and data as necessary.

Remove empty rows.
```{r}
colnames(df_WRUSquad_2008) <- c("Player", "Position", "DOB", "Caps", "Club")
df_WRUSquad_2008 <- df_WRUSquad_2008 %>% 
  filter(Player != "")  
```

Split out DOB into 3 columns
```{r}
library(stringr)
df_WRUSquad_2008 <- df_WRUSquad_2008 %>% separate(DOB, c('DOB_Day', 'DOB_Month', 'DOB_Year'))
 
print(df_WRUSquad_2008)
```

I want to add a Squad year column to all rows
```{r}
C_len <- nrow(df_WRUSquad_2008)
C_len

Squad_Year_Pop <-rep(c(2008),times=C_len)
df1<-data.frame(Squad_Year_Pop)
Squad_Year

df_WRUSquad_2008 = data.frame(df_WRUSquad_2008, Squad_Year)
print(df_WRUSquad_2008)
```

Display and write cleaned table
```{r}
print(df_WRUSquad_2008)
write.csv(df_WRUSquad_2008, file = "df_WRUSquad_2008.csv")
```

Repeat for other years
2009

```{r}
url <- "https://en.wikipedia.org/wiki/2009_Six_Nations_Championship_squads"

webpage <- read_html(url)
tables <- html_nodes(webpage, "table")

WRUSquad_2009 <- html_table(tables[[6]], fill = TRUE)
df_WRUSquad_2009 <- as.data.frame(WRUSquad_2009)
colnames(df_WRUSquad_2009) <- c("Player", "Position", "DOB", "Caps", "Club")
df_WRUSquad_2009 <- df_WRUSquad_2009 %>% 
  filter(Player != "")  

print(df_WRUSquad_2009)
write.csv(df_WRUSquad_2009, file = "df_WRUSquad_2009.csv")
```
